services:
  gateway:
    image: ocelot-gateway
    build:
      context: .
      dockerfile: src/Gateway/Dockerfile
    container_name: ocelot-gateway
    ports:
      - "0.0.0.0:7777:7777"
    environment:
      - ASPNETCORE_URLS=http://+:7777
    depends_on:
      - sales-api
    networks:
      - evaluation-network

  sales-api:
    image: sales-api
    build:
      context: .
      dockerfile: src/SalesApi/Dockerfile
    container_name: sales-api
    depends_on:
      - db
      - rabbitmq

    ports:
      - "8090:8090"
    environment:
     ConnectionStrings__SalesApiDb: Host=db;Database=SalesApiDb;Username=postgres;Password=admin
     RABBITMQ__PREFETCHCOUNT: 2000
     RABBITMQ__HOSTNAME: rabbitmq
     RABBITMQ__PORT: 5672
     RABBITMQ__USERNAME: usuarioMaster
     RABBITMQ__PASSWORD: s3nh40k
     RABBITMQ__VIRTUALHOST: main
     RABBITMQ__DISPATCHCONSUMERSASYNC: "true"

    networks:
      - evaluation-network
  
  db:
    image: postgres:latest
    container_name: db
    environment:
      POSTGRES_DB: SalesApiDb
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: admin
    ports:
      - "5432:5432"
    networks:
      - evaluation-network

  rabbitmq:
   hostname: rabbitmq
   build:
    context: ./rabbit
   ports:
    - "15672:15672"
    - "5672:5672" 
    - "15692:15692" 
   networks:
    - evaluation-network

networks:
  evaluation-network:
    external: true
  